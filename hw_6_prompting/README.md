Здравствуйте!

Сегодня у вас непростая домашняя работа, но я уверен, что вы справитесь!

Задание основано на реальном проекте. Оригинальный проект был, конечно, намного сложнее, но я его упростил (а то вдруг сделаете лучше нас и начнёте конкурировать! Шутка), чтобы его можно было сделать за несколько дней.

Кстати, несмотря на то, что у вас есть только небольшой кусочек каталога, который я ещё и обфусцировал, большая просьба — не распространять его. Мало ли что.

Теперь к описанию задачи.

К вам обратилась компания из далёкой страны, например, Аргентины. Фирма занимается металлообработкой. Каждый день к ним приходят клиенты с заказами. Заказ — это, как правило, письмо, например: "Здравствуйте, мы хотим заказать у вас 20 труб диаметром 108 мм и длиной 6 метров". Заказ попадает к агенту, который определяет, чего именно хотят клиенты, ищет по большой базе данных, выясняет, что есть в наличии, и формирует коммерческое предложение.

Поскольку заказов много, возникла идея автоматизировать этот процесс.

На первой стадии вам не нужно будет вытаскивать заказы из писем — это уже сделано за вас (файл queries.csv). Ваша задача — распарсить строки и найти в базе данных подходящие товары (или не найти, если их нет). База данных представлена в файле catalog.csv. Конечно, клиенты допускают ошибки, опечатки и не всегда следуют стандартам индустрии. (Но я не настолько злой — я привёл данные в более-менее приличный вид).

База данных тоже далека от идеала. Она составлена разными людьми, которые использовали немного разные форматы и сокращения. Но это всё, что у нас есть.

Элемент базы данных — это строка, содержащая название, размеры, материал и модификаторы (например, полировка). Я настоятельно рекомендую ввести несколько строк в ChatGPT — он подскажет, что к чему.

Ах да, вы же знаете, что в Аргентине говорят на испанском? Так вот — все запросы на испанском. И база данных тоже. Всё это наводит на мысль использовать LLM, которая знает испанский. Например, Mixtral, LLAMA или ChatGPT. Кстати, они, возможно, понимают что-то и про металлообработку.

Итак, ваша задача — написать сервис (server.py). На эндпоинт (http://127.0.0.1:3400/api/ml-service/parse_queries) он получает строки из файла queries.csv и на выходе должен вернуть артикул (SKU), описание из каталога (чтобы вам было легче отлаживать), а также количество. Если товара нет, то вернуть элемент с пустым артикулом. (Для запросов используйте Postman или curl.)

Все вспомогательные файлы для сервера я уже написал — их трогать не нужно (хотя вы, конечно, можете). Чтобы запустить сервер, установите пакеты pip install -r requirements.txt и запустите файл server.py. Пройдитесь по коду — я оставил комментарии, что нужно реализовать.

Рабочая версия (35 баллов)

Более сложные задания (на выбор):

Тут можно почувствовать всю мощь LLM. Используйте LLM, чтобы нагенерировать реальные письма (возьмите случайные продукты из каталога и дайте запрос LLM-ке: сгенерируй деловое письмо на испанском. Стиль и всё вот это да). 5 баллов

Следующая задача — с помощью LLM определить, что в них заказано, и пропустить через пайплайн из предыдущего задания. 10 баллов

Поиск в каталоге сейчас реализован через базу данных и эмбеддинги. Это работает, но не очень хорошо. Вам придётся дорабатывать результаты вручную. Было бы здорово, если бы поиск можно было реализовать с использованием LLM, хотя бы для выбора наиболее вероятных кандидатов. Это сложная задача, но если вы справитесь — молодцы! (15 баллов)

Опыт показывает, что стоит использовать модели от 7 миллиардов параметров и выше. Я написал обвязку для https://www.together.ai/ (API-ключ должен быть в .env), но вы можете использовать любые другие эндпоинты и модели. Не стесняйтесь менять мой код — он далёк от идеала (и написан немного на коленке). Я показал вам возможный путь, но вы можете сделать так, как вам удобнее. Главное, чтобы работало.

В файле examples.csv я привёл примеры запросов и ответов.